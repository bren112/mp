<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pagamentos Aprovados</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f4f6f8;
    }
    h2 {
      color: #2e7d32;
      margin-bottom: 20px;
    }

    /* Desktop: tabela normal */
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px 15px;
      text-align: left;
    }
    th {
      background-color: #e8f5e9;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    /* Mobile: esconder tabela, mostrar cards */
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead {
        display: none;
      }
      tbody tr {
        background: white;
        margin-bottom: 15px;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        border: 1px solid #ccc;
      }
      tbody tr td {
        border: none;
        padding: 6px 0;
        position: relative;
        padding-left: 120px;
        text-align: left;
        font-size: 14px;
        line-height: 1.3;
        word-wrap: break-word;
      }
      tbody tr td::before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        top: 6px;
        font-weight: bold;
        color: #555;
        white-space: nowrap;
      }
    }
  </style>
</head>
<body>
  <h2>Lista de Pagamentos Aprovados</h2>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>CPF</th>
        <th>Valor</th>
        <th>Cidade</th>
        <th>Payment ID</th>
      </tr>
    </thead>
    <tbody id="tabela-pagamentos">
      <!-- Linhas serÃ£o inseridas via JavaScript -->
    </tbody>
  </table>

  <script>
    const SUPABASE_URL = "https://jrbpwisclowinultbehj.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyYnB3aXNjbG93aW51bHRiZWhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU3NTc4NjMsImV4cCI6MjA0MTMzMzg2M30.dFbRcWi0v7zdiR58ZcuTNfMTzi_GKg_56VL1-UT2JYs";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function carregarPagamentos() {
      const tbody = document.getElementById("tabela-pagamentos");

      const { data, error } = await supabaseClient
        .from('pagamentos_pix')
        .select('first_name, last_name, cpf, valor, cidade, payment_id');

      if (error) {
        console.error('Erro ao buscar pagamentos:', error);
        tbody.innerHTML = `<tr><td colspan="5">Erro ao carregar dados.</td></tr>`;
        return;
      }

      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5">Nenhum pagamento encontrado.</td></tr>`;
        return;
      }

      tbody.innerHTML = '';

      data.forEach(pag => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="Nome">${pag.first_name} ${pag.last_name || ''}</td>
          <td data-label="CPF">${pag.cpf}</td>
          <td data-label="Valor">R$ ${parseFloat(pag.valor).toFixed(2)}</td>
          <td data-label="Cidade">${pag.cidade || ''}</td>
          <td data-label="Payment ID">${pag.payment_id || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    carregarPagamentos();
  </script>
</body>
</html>
